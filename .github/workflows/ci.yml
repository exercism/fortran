name: fortran / main

on:
  push:
    branches: [master, main]
  pull_request:
  workflow_dispatch:

jobs:
  linux-min:
    name: Linux Min Config
    runs-on: ubuntu-16.04
    steps:
      - uses: actions/checkout@v2.3.4
      - name: Install project dependencies
        run: |
          sudo apt-get update -q
          sudo apt-get install -y gfortran cmake

      - name: Run exercism/fortran ci (runs tests) for all exercises
        run: |
          mkdir build
          cd build
          cmake ..
          cmake --build .
          ctest -V

  linux-latest:
    name: Linux Latest Config
    needs: [linux-min]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2.3.4
      - name: Install project dependencies
        run: |
          sudo apt-get update -q
          sudo apt-get install -y gfortran cmake

      - name: Run exercism/fortran ci (runs tests) for all exercises
        run: |
          mkdir build
          cd build
          cmake ..
          cmake --build .
          ctest -V



  mac:
    name: MacOS
    needs: [linux-min]
    runs-on: macOS-latest
    steps:
    - uses: actions/checkout@v2.3.4
    - name: Install project dependencies
      run: |
        brew list cmake || brew cask install cmake
        brew list gfortran || brew cask install gfortran
    - name: Run exercism/fortran ci (runs tests) for all exercises
      run: |
        which gcc
        which gfortran
        mkdir build
        cd build
        cmake ..
        cmake --build .
        ctest -V
